<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>BMW Dashcam Oven</title>
    <link rel="stylesheet" href="styles.css" />
    <link rel="icon" href="assets/favicon.png" type="image/png" />
    <meta name="description" content="Burn BMW dashcam metadata (date/time/speed/GPS) into video in your browser." />
  </head>
  <body>
    <header class="site-header">
      <div class="brand">
        <img src="assets/favicon.png" alt="BMW dashcam oven" class="logo" width="40" height="40" />
        <div class="title">
          <h1>BMW Dashcam Oven</h1>
          <p>Burn-in time, speed, and GPS overlays - locally.</p>
        </div>
        <div class="badges">
          <span class="badge">100% Vibe-coded</span>
          <a class="badge badge-link" href="https://github.com/iAbadia/bmw-dashcam-oven" target="_blank" rel="noopener noreferrer" title="View on GitHub" aria-label="View repository on GitHub">
            <svg class="icon icon-github" viewBox="0 0 24 24" aria-hidden="true">
              <path d="M12 .5a11.5 11.5 0 0 0-3.64 22.41c.58.11.79-.25.79-.56v-2c-3.2.7-3.88-1.37-3.88-1.37-.53-1.35-1.3-1.71-1.3-1.71-1.06-.72.08-.71.08-.71 1.17.08 1.79 1.2 1.79 1.2 1.04 1.78 2.73 1.26 3.4.96.1-.77.41-1.27.75-1.56-2.55-.29-5.23-1.28-5.23-5.7 0-1.26.45-2.29 1.2-3.1-.12-.29-.52-1.47.11-3.07 0 0 .98-.31 3.2 1.18a11.1 11.1 0 0 1 5.82 0c2.22-1.49 3.2-1.18 3.2-1.18.63 1.6.23 2.78.11 3.07.74.81 1.2 1.84 1.2 3.1 0 4.43-2.69 5.41-5.25 5.7.42.36.8 1.07.8 2.16v3.2c0 .31.21.67.8.56A11.5 11.5 0 0 0 12 .5Z"/>
            </svg>
          </a>
        </div>
      </div>
    </header>

    <main>
      <section class="inputs">
        <div class="input hidden">
          <label for="method">Processing method</label>
          <select id="method" disabled>
            <option value="realtime" selected>Realâ€‘time (Canvas + MediaRecorder)</option>
          </select>
        </div>
        <div class="input">
          <label for="metadataFile">Metadata JSON</label>
          <input id="metadataFile" type="file" accept="application/json" />
        </div>
        <div class="input">
          <label for="videoFiles">Video .ts file(s)</label>
          <input id="videoFiles" type="file" accept=".ts,video/MP2T" multiple />
        </div>
        <div class="input hidden" id="fontWrap">
          <label for="fontFile">Font (TTF) for FFmpeg drawtext</label>
          <input id="fontFile" type="file" accept=".ttf" />
        </div>
        <div class="input">
          <label for="overlayPosition">Overlay position</label>
          <select id="overlayPosition">
            <option value="bottom-left">Bottom left</option>
            <option value="bottom-right">Bottom right</option>
            <option value="top-left">Top left</option>
            <option value="top-right">Top right</option>
          </select>
        </div>
        <div class="input">
          <label for="fontSize">Font size (px)</label>
          <input id="fontSize" type="number" min="10" max="72" value="24" />
        </div>
        <div class="actions">
          <button id="processBtn" disabled>Bake!</button>
        </div>
      </section>

      <section class="status">
        <h2>Status</h2>
        <div class="log-controls">
          <label><input type="checkbox" id="debugToggle"> Verbose logging</label>
          <button id="clearLogBtn" type="button">Clear</button>
          <button id="downloadLogBtn" type="button">Download Log</button>
        </div>
        <div class="progress-wrap">
          <progress id="progress" value="0" max="1"></progress>
          <span id="progressText">Idle</span>
        </div>
        <pre id="log"></pre>
      </section>

      <section class="preview hidden">
        <h2>Preview</h2>
        <div class="players">
          <video id="video" controls playsinline></video>
          <canvas id="canvas"></canvas>
        </div>
      </section>

      <section class="output hidden">
        <h2>Output</h2>
        <div id="downloads"></div>
      </section>
    </main>

    

    <!-- Self-hosted ffmpeg.wasm (no CDN). These files must exist under vendor/ffmpeg/. -->
    <script src="vendor/ffmpeg/ffmpeg.js"></script>
    <script>
      window.FFMPEG_CORE_URL = 'vendor/ffmpeg/ffmpeg-core.js';
    </script>
    <!-- Minimal inline log to verify DOM and logging area are present -->
    <script>
      (function(){
        function inlinePing(tag){
          try {
            var el = document.getElementById('log');
            if (el) { el.textContent += tag + '\n'; el.scrollTop = el.scrollHeight; }
            else { console.log(tag + ' (no #log element)'); }
          } catch (e) { console.log('inline log error', e); }
        }
        if (document.readyState === 'loading') {
          window.addEventListener('DOMContentLoaded', function(){ inlinePing('[inline] DOMContentLoaded'); }, { once: true });
        } else {
          inlinePing('[inline] DOM already ready');
        }
      })();
    </script>
    <script src="src/app.js"></script>
  </body>
  </html>
